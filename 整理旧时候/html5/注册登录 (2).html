<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>注册登录</title>
    <style>
        *{
            margin: 0;
            padding: 0;
        }
        form{
            width: 400px;
            height: 300px;
            line-height: 100px;
            text-align: center;
            background: lightyellow;
            margin:20px auto;
        }
        input{
            width: 200px;
            height: 50px;
            line-height: 50px;
            border:1px solid orange;
            border-radius: 10px;
            outline:none;
        }
        input[type=button]{
            width: 100px;
        }
        .success{
            color: green;
        }
        .error{color:red}
    </style>
</head>
<body>
    <form>
        昵称：<input type="text" id="username"><span></span>
        <br>
        密码：<input type="password" id="password"><span></span>
        <br>
        <input type="button" value="登录" id="login">
        <input type="button" value="注册" id="register">
    </form>
</body>
<script>
    //登录按钮
    const loginBtn = document.querySelectorAll("input[type=button]")[0];
    //注册按钮
    const registerBtn = document.querySelectorAll("input[type=button]")[1];
    //用户名输入框
    const userInp = document.querySelector("input[type=text]");
    //密码输入框
    const passwordInp = document.querySelector("input[type=password]");
    //你想存成什么格式：
    //key:register
    //value:[{name:"",password:""},{name:"",password:""}]
   	    userInp.onblur = function(){
            function userTrue(){
                for(let i=0;i<userArray.length;i++){
                  
                      if(  userArray[i].name==userInp.value) return true;
                    
                }
            }
	        var span = this.nextSibling || this.nextElementSibling;
           
           /*  if( userTrue()){
                alert('用户名已存在')
            }
	       else */ if (/^[\u3040-\u309F\u4e00-\u9fa5\uf900-\ufa2d]{2,4}$/.test(this.value)){
	            span.innerHTML = '用户名可用';
	            span.className = 'success';
	        }else{
	            span.innerHTML = '用户名不符合要求';
	            span.className = 'error';
	        }
	    };
   		passwordInp.onblur = function(){
	        var span = this.nextSibling || this.nextElementSibling;
	        if (/^[a-zA-Z0-9]{4,16}$/.test(this.value)){
	            span.innerHTML = '密码可用';
	            span.className = 'success';
	        }else{
	            span.innerHTML = '密码不符合要求';
	            span.className = 'error';
	        }
	    };
    //需要有一个数组，里面存放所有用户的信息，初始值为[]
    let userArray = window.localStorage.getItem("register")||"[]";
	//转换成数组
    userArray = JSON.parse(userArray);
    //注册流程
    registerBtn.onclick=()=>{
        let username = userInp.value;
        let password = passwordInp.value;
        let user = {name:username,password:password};
        //重名不允许注册
        for(let i=0;i<userArray.length;i++){
            if(userArray[i].name==username){
                alert("该用户名以被占用");
               	return;
            }else{
                alert('注册成功')
            }
        }
		if(/^[\u3040-\u309F\u4e00-\u9fa5\uf900-\ufa2d]{2,4}$/.test(userInp.value)&&/^[a-zA-Z0-9]{4,16}$/.test(passwordInp.value))
		    {
		    	userArray.push(user);
				window.localStorage.setItem("register",JSON.stringify(userArray))
		    } 
		    else{
		    	alert("格式不正确，不能注册");
		    }
    }
    //登录流程
    loginBtn.onclick=()=>{
        let username = userInp.value;
        let password = passwordInp.value;
		
        //如果用户名和密码相同则登录成功
        for(let i=0;i<userArray.length;i++){
            if(userArray[i].name==username){
                if(userArray[i].password==password){
                    alert("登录成功")
                }else{
                	alert("密码不正确")
                }
                // return;
            }else{
            	// alert("用户未注册")
            }
        }
    }

</script>
</html>