<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
        <form>
            <input type="text" name="username" placeholder="用户名">
            <input type="password" name="password" placeholder="密码">
            <input type="file" name="file">
            <div></div>
        </form>
        <input type="button" value="上传" >
        
    <script>
   /*  var xhr=new XMLHttpRequest();
    xhr.open('post','sever.js');
    xhr.setRequestHeader('Content-Type','appplication/x-www-foru-..')
    xhr.send();
    xhr.onreadystatechange=function (){
        if(xhr.readyState==4&&xhr.status==200){

        }
    }     */
    //FormData
 /*    const form=new FormData();
    form.append('username','张三');
    form.append('password','123');
    form.appen('file',file);
    var xhr=new XMLHttpRequest();
    xhr.open('post','sever.js');
    xhr.send(form);
    xhr.onload=function(){
        console.log('success');
    }
 */
    function sendForm(form,url){
        const fileDom=form.querySelector('input[type=file]');
        console.log(fileDom.files)
           const pWordDom=form.querySelector('input[type=password]');
           const textDom=form.querySelector('input[type=text]');
           const perSize=2*1024*1204;
          this.addEventListener('click',function(){
            const file=fileDom.files[0];
           console.log(file)
           const size=file.size;
           const fileName=file.name;
           const totalCount=Math.ceil(size/perSize);
           let success=0;
           for(let i=0;i<totalCount;i++){
               const start=i*perSize;
               const end=(i+1)*perSize;
               const formData=new FormData();
                formData.append('name',fileName);
                formData.append('total',totalCount);
                formData.append('index',i);
                formData.append('data',file.slice(start,end));
                formData.append('password',pWordDom.value);
                var xhr=new XMLHttpRequest();
                xhr.open('post',url);
                xhr.send(formData);
                xhr.onload=function(){
                    ++success;
                    console.log('总共要上传：'+totalCount+'次，现在已完成：'+success+'次')
                }
           }
          })

    }
    var form=document.querySelector('form');
    var uploadBtn=document.querySelector('input[type=button]');
    uploadBtn.addEventListener('click',sendForm(form,'sever.js'))
    </script>
</body>
</html>