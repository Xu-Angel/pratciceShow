<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
    canvas{  
            position: absolute;  
            top: 100px;  
            left: 100px;  
            /*图表的右侧边线*/  
            border-right: 1px solid gray;  
} 
    </style>
</head>
<body>
        <canvas id="can1" width="560" height="324"></canvas>  
        <script type="text/javascript">  
                var can1 = document.getElementById("can1");  
                var ctx = can1.getContext("2d");  
               
                var colGaps = 60;//定义柱状图宽度  
                var data = [
            {
                value: 0.2,
                color: "chartreuse",
                text: "小学生"
            }, {
                value: 0.1,
                color: "yellow",
                text: "初中生"
            }, {
                value: 0.3,
                color: "blue",
                text: "高中生"
            }, {
                value: 0.4,
                color: "pink",
                text: "大学生"
            }
        ];
        var cols = (can1.width - 90)/data.length;//逐个柱子占位宽度和间距共90  
                // 绘制行  
                function drawRows(){  
                    var rows = 9;  
                    //列步长  
                    var rW = can1.height/rows;  
                    for (var i = 0 ; i <= rows; i ++){  
                        ctx.beginPath();  
                        //绘制行  
                        ctx.moveTo(90,i*rW);  
                        ctx.lineTo(can1.width,i*rW);  
                        //绘制坐标点  
                        ctx.font = "15px scans-serif";  
                        ctx.fillStyle = "#92000f";  
                        var colsNo = ctx.measureText(i*36);//设置好字体才能计算字体宽度  
                        ctx.fillText(i*36,85-colsNo.width,can1.height - i*36);  
                        //绘制图标左侧边线,为了避免重新定义绘制它的方法，这里把它放在for循环里面，所以在相同位置画了10遍  
                        ctx.moveTo(90,0);  
                        ctx.lineTo(90,can1.height);  
                        ctx.closePath();  
                        ctx.stroke();  
                    }  
                }  
                //绘制柱子和顶端数字  
                let num=0
                function drawRects(t){  
                    num+=0.5;
                  let i=t;
              
                            //绘制柱状图  
                        ctx.lineWidth = 1;  
                        ctx.strokeStyle = '#000';  
                        ctx.fillStyle = data[i].color;  
                        ctx.beginPath();  
                        ctx.rect((i+1)*cols,num-data[i].value*300,colGaps,data[i].value*300);//横坐标为90的倍数，纵坐标为画布高度减去柱子高度  
                        ctx.fill();  
                    
                        //绘制柱状图顶部数值  
                        ctx.font = "18px scans-serif";  
                        ctx.fillStyle = "red";  
                        var text = ctx.measureText(data[i].text);  
                        var value=ctx.measureText(data[i].value);
                        ctx.fillText(data[i].text,(i+1)*cols+(colGaps-text.width)/2,can1.height-data[i].value-10);//数字横坐标为90的倍数加上柱子宽度减去自身宽度的差的一半的和，纵坐标为画布高度减去柱子高度再减去一个合适的值  
                        ctx.fillText(data[i].value,(i+1)*cols+(colGaps-value.width)/2,can1.height-data[i].value*300-5);//数字横坐标为90的倍数加上柱子宽度减去自身宽度的差的一半的和，纵坐标为画布高度减去柱子高度再减去一个合适的值  
                        ctx.closePath();  
                        ctx.stroke(); 
                        
                        console.log(i)
                
                        if(can1.height==num){
                            i++;
                            num=0;
                         
                        }
                        drawRects(i)
                   
                }  
                
                drawRows();//画行线和横坐标  
                drawRects('0');//画柱子和数值  
                </script>
</body>
</html>