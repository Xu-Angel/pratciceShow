<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>jsonp加载贵重金属数据</title>
    <style>
        .increase{color: red;}
        .decrease{color: green;}
        .zero{color: black;}
    </style>
</head>
<body>
<table>
    <thead>
    <tr><th>名称</th><th>价格</th><th>涨跌幅度</th></tr>
    </thead>
    <tbody>
    </tbody>
</table>
</body>
<script src="jquery.min-1.12.4.js"></script>
<script>
    (function(){
        // 1. 发出ajax请求
        // 2. 把获取到数据进行拼接
        // 3. 把拼接好的字符串添加到tbody中，形式新的DOM节点
        // 4. 设置定时器，每隔一段时间就向服务器请求获取新的数据

        var tbody = $('tbody');
        //var tbody = document.querySelector('tbody'); // 原生js
        getData();
        setInterval(getData, 5000);

        /*
        通过设置dataType的类型为jsonp时，就可以使用ajax实现跨域的访问
        */

        function getData(){
            // 使用jQuery自动生成的jsonp回调函数
            $.ajax({
                url: 'http://172.17.12.10:8080/webserver/stock',
                type: 'get',
                success: function(data){
                    var arr = data.data;    // 服务器响的数据
                    var html = '';
                    var tmp;
                    for (var i=0;i<arr.length;i++){
                        tmp = arr[i];
                        var className = tmp.unit > 0 ? 'increase' : tmp.unit < 0 ? 'decrease' : 'zero';
                        html += '<tr><td>' +
                            tmp.name +
                            '</td><td class="' + className + '">' +
                            tmp.now +
                            '</td><td class="' + className + '">' +
                            Math.round(tmp.unit * 10000) / 100 +
                            '%</td></tr>';
                    }
                    tbody.html(html);
                    //tbody.innerHTML = html;   // 原生js
                },
                dataType: 'jsonp',
                error: function(error){
                    console.log(error)
                }
            });

            /*$.ajax({
                url: 'http://172.17.12.10:8080/webserver/stock',
                type: 'get',
                jsonpCallback: 'foo',       //  这个函数是由jQuery生成，不需要自己实现
                success: function(data){
                    var arr = data.data;    // 服务器响的数据
                    var html = '';
                    var tmp;
                    for (var i=0;i<arr.length;i++){
                        tmp = arr[i];
                        var className = tmp.unit > 0 ? 'increase' : tmp.unit < 0 ? 'decrease' : 'zero';
                        html += '<tr><td>' +
                            tmp.name +
                            '</td><td class="' + className + '">' +
                            tmp.now +
                            '</td><td class="' + className + '">' +
                            Math.round(tmp.unit * 10000) / 100 +
                            '%</td></tr>';
                    }
                    tbody.html(html);
                },
                dataType: 'jsonp',
                error: function(error){
                    console.log(error)
                }
            });*/
        }
    })();

</script>
</html>